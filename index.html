<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BBGM Career Hybrid</title>

<style>
:root {
  --bg-main:#0b0b0b;
  --bg-card:#161616;
  --bg-header:#111;
  --bg-highlight:#2a2a2a;
  --border:#333;
  --text:#eaeaea;
  --muted:#9a9a9a;
  --accent:#f5c518;
  --radius:12px;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg-main);
  color:var(--text);
  font-family:system-ui;
}
header{
  background:var(--bg-header);
  color:var(--accent);
  padding:14px;
  text-align:center;
  font-weight:700;
  border-bottom:1px solid var(--border);
}
nav.menu{
  display:flex;
  padding:6px;
  gap:4px;
  background:var(--bg-header);
  border-bottom:1px solid var(--border);
}
nav.menu button{
  flex:1;
  background:transparent;
  color:var(--muted);
  border:none;
  padding:6px;
  border-radius:6px;
}
nav.menu button.active{
  background:var(--bg-highlight);
  color:var(--text);
  font-weight:600;
}
main{
  max-width:720px;
  margin:0 auto;
  padding:12px;
}
section.card{
  display:none;
  background:var(--bg-card);
  border-radius:var(--radius);
  padding:12px;
}
section.card.active{display:block}
button.action{
  width:100%;
  padding:8px;
  background:#222;
  color:var(--text);
  border:none;
  border-radius:8px;
  margin-top:6px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
th,td{
  border-bottom:1px solid var(--border);
  padding:4px;
  text-align:center;
}
.highlight{background:var(--bg-highlight);font-weight:700}
.log{font-size:11px;color:var(--muted);line-height:1.4}
</style>
</head>

<body>

<header>BBGM Career Hybrid</header>

<nav class="menu">
  <button data-view="career" class="active">Career</button>
  <button data-view="player">Player</button>
  <button data-view="team">Team</button>
  <button data-view="training">Training</button>
  <button data-view="log">Log</button>
</nav>

<main>

<section class="card active" id="career">
  <h3>Career</h3>
  <div class="log">
    Season <span id="seasonYear"></span> —
    Game <span id="seasonGame"></span>/82 —
    Week <span id="seasonWeek"></span>
  </div>
  <button class="action" onclick="nextGame()">Next Game</button>
  <button class="action" onclick="demandRole()">Demand Bigger Role</button>
</section>

<section class="card" id="player">
  <h3>Player</h3>
  <div id="playerInfo"></div>
</section>

<section class="card" id="team">
  <h3>Team Depth Chart</h3>
  <div id="teamInfo"></div>
</section>

<section class="card" id="training">
  <h3>Training Focus</h3>
  <button class="action" onclick="train('shooting')">Shooting</button>
  <button class="action" onclick="train('finishing')">Finishing</button>
  <button class="action" onclick="train('playmaking')">Playmaking</button>
  <button class="action" onclick="train('defense')">Defense</button>
</section>

<section class="card" id="log">
  <h3>Career Log</h3>
  <div id="logBox" class="log"></div>
</section>

</main>

<script>
/* ===== UTIL ===== */
function rand(min,max){return Math.floor(min+Math.random()*(max-min))}
function calcOVR(r){
  return Math.round(
    (r.shooting+r.finishing+r.playmaking+
     r.defense+r.athleticism+r.iq+r.mental)/7
  );
}

/* ===== SEASON ===== */
let season={year:1,gamesPlayed:0,maxGames:82,week:1,phase:"regular"};

/* ===== ROLE USAGE ===== */
const ROLE_USAGE={
  Primary:0.32,
  Secondary:0.24,
  "3&D":0.16,
  Bench:0.10
};

/* ===== PLAYER GEN ===== */
function genPlayer(team){
  return{
    name:["Jalen","Marcus","Devin","Tyrese","Andre","Cole"][rand(0,6)]+" "+
         ["Williams","Brooks","Harris","Knight","Carter","Reed"][rand(0,6)],
    pos:["PG","SG","SF","PF","C"][rand(0,5)],
    team,
    ratings:{
      shooting:rand(45,85),
      finishing:rand(45,85),
      playmaking:rand(45,85),
      defense:rand(45,85),
      athleticism:rand(45,85),
      iq:rand(45,85),
      mental:rand(45,85)
    },
    hidden:{consistency:Math.random(),ego:Math.random()},
    role:"Bench",
    minutes:12,
    fatigue:0,
    stats:{g:0,pts:0},
    career:{games:0,points:0},
    isUser:false
  };
}

/* ===== LEAGUE ===== */
const TEAMS=["ATL","BOS","LAL","GSW","MIA"];
const league={teams:{},players:[]};

TEAMS.forEach(t=>{
  league.teams[t]={code:t,pace:rand(96,104),roster:[]};
  for(let i=0;i<12;i++){
    const p=genPlayer(t);
    league.players.push(p);
    league.teams[t].roster.push(p);
  }
});

/* ===== ROLES ===== */
function assignRoles(team){
  team.roster.sort((a,b)=>calcOVR(b.ratings)-calcOVR(a.ratings));
  team.roster.forEach((p,i)=>{
    if(i===0){p.role="Primary";p.minutes=34}
    else if(i<3){p.role="Secondary";p.minutes=28}
    else if(i<6){p.role="3&D";p.minutes=22}
    else{p.role="Bench";p.minutes=12}
  });
}
Object.values(league.teams).forEach(assignRoles);

/* ===== USER ===== */
const user=league.players[rand(0,league.players.length)];
user.isUser=true;
const userTeam=league.teams[user.team];

/* ===== PLAYER GAME SIM (REFACTORED) ===== */
function simGame(p,t){
  const usage=ROLE_USAGE[p.role]||0.1;
  const fatiguePenalty=1-Math.min(p.fatigue*0.015,0.35);

  const touches=t.pace*(p.minutes/48)*usage;
  const skill=(
    p.ratings.shooting*0.4 +
    p.ratings.finishing*0.3 +
    p.ratings.mental*0.2 +
    p.ratings.iq*0.1
  )/100;

  const variance=1+(Math.random()-0.5)*(1-p.hidden.consistency);
  const pts=Math.max(0,Math.round(touches*skill*variance*fatiguePenalty));

  p.stats.g++; p.stats.pts+=pts;
  p.career.games++; p.career.points+=pts;
  p.fatigue+=p.minutes/48;
}

/* ===== NEXT GAME ===== */
function nextGame(){
  if(season.gamesPlayed>=season.maxGames){ endSeason(); return; }

  Object.values(league.teams).forEach(t=>{
    t.roster.forEach(p=>simGame(p,t));
  });

  season.gamesPlayed++;

  if(season.gamesPlayed%4===0){
    season.week++;
    league.players.forEach(p=>p.fatigue=Math.max(0,p.fatigue-0.8));
    log(`Week ${season.week} recovery`);
  }

  log(`Game ${season.gamesPlayed} completed`);
  render();
}

/* ===== SEASON END ===== */
function endSeason(){
  log(`Season ${season.year} complete`);
  log(`You averaged ${(user.stats.pts/user.stats.g).toFixed(1)} PPG`);

  league.players.forEach(p=>{
    Object.keys(p.ratings).forEach(r=>{
      p.ratings[r]=Math.max(40,Math.min(99,p.ratings[r]+rand(-3,4)));
    });
    p.stats={g:0,pts:0};
    p.fatigue=0;
  });

  season.year++;
  season.gamesPlayed=0;
  season.week=1;
  Object.values(league.teams).forEach(assignRoles);
  log(`Season ${season.year} begins`);
  render();
}

/* ===== TRAINING ===== */
function train(stat){
  user.ratings[stat]=Math.min(99,user.ratings[stat]+rand(1,3));
  assignRoles(userTeam);
  log(`Training: ${stat}`);
  render();
}

/* ===== ROLE DEMAND ===== */
function demandRole(){
  if(Math.random()<user.hidden.ego){
    user.role="Primary";
    log("Coach increases your role");
  }else{
    user.role="Bench";
    log("Coach limits your role");
  }
  assignRoles(userTeam);
  render();
}

/* ===== LOG ===== */
function log(msg){
  const box=document.getElementById("logBox");
  box.innerHTML=`• ${msg}<br>`+box.innerHTML;
}

/* ===== RENDER ===== */
function render(){
  document.getElementById("seasonYear").textContent=season.year;
  document.getElementById("seasonGame").textContent=season.gamesPlayed;
  document.getElementById("seasonWeek").textContent=season.week;

  document.getElementById("playerInfo").innerHTML=`
    <b>${user.name}</b><br>
    ${user.pos} | ${user.team} | ${user.role}<br>
    Minutes: ${user.minutes} |
    Usage: ${(ROLE_USAGE[user.role]*100).toFixed(0)}% |
    Fatigue: ${(user.fatigue*10).toFixed(0)}%<br>
    OVR ${calcOVR(user.ratings)} |
    PPG ${(user.stats.pts/user.stats.g||0).toFixed(1)}<br>
    <span class="muted">
      Career: ${user.career.games} GP · ${user.career.points} PTS
    </span>
    <table>
      ${Object.entries(user.ratings).map(([k,v])=>`
        <tr><td>${k}</td><td>${v}</td></tr>`).join("")}
    </table>
  `;

  document.getElementById("teamInfo").innerHTML=`
    <table>
      <tr><th>Name</th><th>OVR</th><th>Role</th></tr>
      ${userTeam.roster.map(p=>`
        <tr class="${p.isUser?"highlight":""}">
          <td>${p.name}</td>
          <td>${calcOVR(p.ratings)}</td>
          <td>${p.role}</td>
        </tr>`).join("")}
    </table>
  `;
}

/* ===== MENU ===== */
function showView(id){
  document.querySelectorAll(".card").forEach(c=>c.classList.remove("active"));
  document.querySelectorAll(".menu button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelector(`[data-view="${id}"]`).classList.add("active");
}
document.querySelectorAll(".menu button").forEach(b=>{
  b.onclick=()=>showView(b.dataset.view);
});

render();
log("Career started");
</script>

</body>
</html>
